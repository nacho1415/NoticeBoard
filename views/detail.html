<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://kit.fontawesome.com/047335fd7c.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/detail.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400&family=Reem+Kufi+Ink&family=Roboto:ital,wght@0,300;1,100&display=swap" rel="stylesheet">
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
</head>
<body>
    <div class="board">
        <div class="boardOutline">
            <div class="topPannel">
                <div class="topPanelHigh">
                    <div class="category">
                        <i class="fa-solid fa-book-open"></i> 
                        <div class="categoryText">
                            자유게시판
                        </div>
                    </div>
                    <div class="title">
                        {{exPost.title}}
                    </div>
                </div>
                <div class="topPanelLow">
                    <div class="leftItem">
                        <Img src="https://mvp.microsoft.com/ko-kr/PublicProfile/Photo/4024653" class="profile" />
                        <div class="info">
                            <div class="nickname">
                                {{exPost.User.nickname}}
                            </div>
                            <div class="postInfo">
                                <div class="dateTime">
                                    2022-11-11 12:24
                                </div>
                                <div class="views">
                                    조회 25
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="rightItem">
                        <i style="margin-right: 4px; font-size: 14px;" class="fa-regular fa-comment-dots"></i>
                        <div class="comment">
                            댓글 4
                        </div>
                        <div class="modify">
                            수정
                        </div>
                        <div class="delete">
                            삭제
                        </div>
                    </div>
                </div>
            </div>
            <div class="midPanel">
                게시글입니다게시글입니다게시글입니다게시글입니다게시글입니다게시글입니다게시글입니다게시글입니다게시글입니다
            </div>
            <div class="lowPanel">
                <div class="profile">
                    <img class="profileImg" src="https://mvp.microsoft.com/ko-kr/PublicProfile/Photo/4024653" alt="">
                    <div class="viewMore flex">
                        <div class="viewmoreNickName">{{exPost.User.nickname}}</div>
                        <div class="viewmoreDefault">님의 게시글 더보기</div>
                    </div>
                </div>
                <div class="signPanel">
                    <div class="likePanel flex align-center">
                        <i style="display: block; color: #F53535;;"class="icon-margin fa-regular fa-heart"></i>
                        <div class="likeText">
                            좋아요 0
                        </div>
                    </div>
                    <div class="flex">
                        <i class="icon-margin fa-regular fa-comment-dots"></i>
                        <div class="commentText">
                            댓글 3
                        </div>
                    </div>
                </div>
            </div>
            <div class="commentPanel">
                <div class="commentHighPanel flex">
                    <div class="DivisionLeft">
                        댓글
                    </div>
                    <div class="DivisionRight flex">
                        <div class="createdAt">
                            등록순
                        </div>
                        <div class="updatedAt">
                            최신순
                        </div>
                    </div>
                </div>
                <div id= "topLevel" class="commentItem">
                    <!-- <img class="profileImg" src="https://mvp.microsoft.com/ko-kr/PublicProfile/Photo/4024653" alt="">
                        
                    </img>
                    <div class="usersCommentRight">
                        <div class="usersNickname">
                            뱅쇼
                        </div>
                        <div class="usersComment">
                            댓글 내용
                        </div>
                        <div class="commentCreatedAt">
                            2022.09.26. 12:34
                        </div>
                    </div> -->
                </div>
            </div>
        </div>
    </div>
</body>
</html>

<script>
    data = [
        // {
        //     id : 1,
        //     content: "대댓글 ㅁㅇㄴㅇㅁㄴㅇㅁㄴㅇㄴㅁㅇㄴ",
        //     UserId: 1,
        //     CommentId: null
        // }, {
        //     id : 2,
        //     content: "대댓글 ㅁㅇㄴㅇㅁㄴㅇㅁㄴㅇㄴㅁㅇㄴ",
        //     UserId: 3,
        //     CommentId: 1
        // }, {
        //     id : 3,
        //     content: "대댓글 ㅁㅇㄴㅇㅁㄴㅇㅁㄴㅇㄴㅁㅇㄴ",
        //     UserId: 2,
        //     CommentId: 2
        // }, {
        //     id : 4,
        //     content: "대댓글 ㅁㅇㄴㅇㅁㄴㅇㅁㄴㅇㄴㅁㅇㄴ",
        //     UserId: 4,
        //     CommentId: null
        // }, {
        //     id : 5,
        //     content: "대댓글 ㅁㅇㄴㅇㅁㄴㅇㅁㄴㅇㄴㅁㅇㄴ",
        //     UserId: 1,
        //     CommentId: null
        // }, {
        //     id : 6,
        //     content: "대댓글 ㅁㅇㄴㅇㅁㄴㅇㅁㄴㅇㄴㅁㅇㄴ",
        //     UserId: 1,
        //     CommentId: 1
        // }, {
        //     id : 7,
        //     content: "대댓글 ㅁㅇㄴㅇㅁㄴㅇㅁㄴㅇㄴㅁㅇㄴ",
        //     UserId: 1,
        //     CommentId: 2
        // },
    ]   

    '{% for comment in exPost.thisComments %}'
        data.push('{{comment}}')
    '{% endfor %}'
        // alert('{{post}}', "??")
    console.log(data)
    for (i = 0; i < data.length; i++) {
        // console.log($('#' + String(data[i].CommentId)).length)
        // console.log($('#' + String(data[i].CommentId)).length == 0)
        if($('#' + String(data[i].CommentId)).length == 0) {
            let html = `
                <div class="duplicate" id=${data[i].id}>
                    <div class="boundary" >
                        <div class="flex userItem" >
                            <img class="profileImg" src="https://mvp.microsoft.com/ko-kr/PublicProfile/Photo/4024653" alt="">
                                    
                            </img>
                            <div class="usersCommentRight">
                                <div class="usersNickname">
                                    뱅쇼
                                </div>
                                <div class="usersComment">
                                    댓글 내용
                                </div>
                                <div class="commentCreatedAt">
                                    2022.09.26. 12:34
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `
            $('#topLevel').append(html)
            // let deep = $('#' + String(data[i].id)).parent().parent().css("margin-left") 
            // console.log(deep)
        } else {
            let html = `
                <div class="childItem" id=${data[i].id}>
                    <div class="boundary" >
                        <div class="flex userItem" >
                            <img class="profileImg" src="https://mvp.microsoft.com/ko-kr/PublicProfile/Photo/4024653" alt="">
                                        
                            </img>
                            <div class="usersCommentRight">
                                <div class="usersNickname">
                                    뱅쇼
                                </div>
                                <div class="usersComment">
                                    "${data[i]}"
                                </div>
                                <div class="commentCreatedAt">
                                    2022.09.26. 12:34
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `  

            $('#' + String(data[i].CommentId)).append(html)
            if ($('#' + String(data[i].CommentId)).children().length == 2) {
            
                //     console.log("????")
            
            let length = $('#' + String(data[i].CommentId)).children('.boundary').children('.userItem').css('padding-left').split("px")[0]
            console.log(length)
            $('#' + String(data[i].id)).children('.boundary').children('.userItem').css('padding-left', String(Number(length) + 33)+"px")
            
            }
        }
        
        // console.log($('#' + String(data[i].CommentId)).children().length, i)
    }
    if (sessionStorage.getItem('accessToken')) {
        const postMyComment = `
                <div class="myComment">
                    <div class="outLineComment">
                        <em style="margin-bottom: 10px; font-weight: 700; font-size: 12px;">닉네임</em>
                        <textarea onkeydown="resize(this)" onkeyup="resize(this)
                            rows="1"
                            wrap=on
                            cols="50"
                            id="commentText"
                            style="font-size:12px;"
                            placeholder = "댓글을 남겨보세요"
                        ></textarea>
                        <div class="buttonBox">
                            <button class="createComment">등록</button>
                        </div>
                    </div>
                </div>
            `
        $('.commentPanel').append(postMyComment)
        // alert(Object.getOwnPropertyNames(a).toString())
        function resize(obj) {
            obj.style.height = '1px';
            obj.style.height = (12 + obj.scrollHeight) + 'px';
        }

        function onTestChange() {
            var key = window.event.keyCode;

            // If the user has pressed enter
            if (key === 13) {
                document.getElementById("commentText").value = document.getElementById("commentText").value + "\n*";
                return false;
            }
            else {
                return true;
            }
        }
    
        $('.createComment').click(() => {
            location.reload();
            const commentText = $('#commentText').val();
            const accessToken = sessionStorage.getItem('accessToken');
            const temp = window.location.href.split("/")
            const page = temp[temp.length-1]
            $.ajax({
                type: "POST",
                url: "http://localhost:3000/home/createComment",
                commentText: commentText,
                headers: {
                    authorization: accessToken,
                },
                data: {
                    content: commentText,
                    postId: page,
                    commentId: 1
                }
            }, function(result){
                alert('success') 
            });
        })
    }
</script>